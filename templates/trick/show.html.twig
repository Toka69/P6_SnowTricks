{% extends 'base.html.twig' %}

{% block title %}Trick details{% endblock %}

{% block body %}
        <div class="container mt-5 pt-3 border rounded">
                <div class="hero-trick-image mb-3" style="background-image: linear-gradient(rgba(0,0,0,.5), rgba(0,0,0,.5)), url('{{ trick.getCover.location }}')">
                        <div class="hero-text">
                                <h1>{{ trick.name|capitalize }}</h1>
                        </div>
                </div>
                <div class="row">
                        {% for photo in trick.photos %}
                        <div class="col-md-3">
                                <div class="card mb-2">
                                        <img src="{{ photo.location }}" alt="trick" class="img-fluid" style="height: 150px">
                                        <div class="card-body d-flex justify-content-end">
                                                <div>
                                                        <a href="#" class="mr-3"><i class="fas fa-pencil-alt"></i></a>
                                                        <a href="#"><i class="fas fa-trash-alt"></i></a>
                                                </div>
                                        </div>
                                </div>
                        </div>
                        {% endfor %}
                        {% for video in trick.videos %}
                        <div class="col-md-3">
                                <div class="card mb-2">
                                        <iframe  src={{ video.location }} frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                        <div class="card-body d-flex justify-content-end">
                                                <div>
                                                        <a href="#" class="mr-3"><i class="fas fa-pencil-alt"></i></a>
                                                        <a href="#"><i class="fas fa-trash-alt"></i></a>
                                                </div>
                                        </div>
                                </div>
                        </div>
                        {% endfor %}
                </div>
                <div class="mt-5 mb-5">
                        <h3>Description :</h3>
                        <article>
                                {{ trick.description }}
                        </article>
                </div>
                <div class="row justify-content-around border rounded pt-3 pb-3 ml-3 mr-3">
                        <a href="{{ path('trick_category', {'slug': trick.category.slug}) }}"><span class="badge badge-primary p-2">{{ trick.category.name }}</span></a>
                        <p>Author: {{ trick.user.firstName }} {{ trick.user.lastName }}</p>
                        <p>Created: {{ trick.createdDate|date }}</p>
                        <p>Modified: {{ trick.modifiedDate|date }}</p>
                </div>
                <hr/>
                <div class="container col-md-8 mt-5">
                        <form method="post" action="">
                                <fieldset>
                                        <div class="form-group">
                                                <textarea class="form-control" id="formControlTextareaMessage" name="message" rows="3" placeholder="Leave a comment" required></textarea>
                                        </div>
                                        <input type="hidden" name="csrfToken" value="" />
                                        <button type="submit" class="btn btn-success">Submit</button>
                                </fieldset>
                        </form>
                </div>
                <hr/>
                <div class="container col-md-8 mt-5">
                        <h6>Comments :</h6>
                        <ul id="myListMore">
                        {% set numberCommentInit = "" %}
                        {% for comment in trick.comments %}
                                {% if loop.index <= 10 %}
                                <li class="card mt-1">
                                        <div class="card-body">
                                                <p class="card-text">
                                                        {{ comment.content }}
                                                </p>
                                        </div>

                                        <div class="card-footer text-muted">
                                                <div class="row">
                                                        <div class="col">
                                                                <img class="rounded-circle profile" src="{{ comment.user.photo }}" alt="photo"/>
                                                        </div>
                                                        <div class="col">
                                                                <div>Author : {{ comment.user.firstName }} {{ comment.user.lastName }}</div>
                                                                <div>Created date : {{ comment.createdDate|date }}</div>
                                                        </div>
                                                </div>
                                        </div>
                                </li>
                                {% endif %}
                                {% set numberCommentInit = loop.index %}
                        {% endfor %}
                        </ul>
                        <ul id="myListMore" class="myList">
                        </ul>
                        {% if numberCommentInit > 10 %}
                        <div class="text-center mb-5">
                                <button class="btn btn-primary" id="loadMore">Load More</button>
                        </div>
                        {% endif %}
                </div>
        </div>
{% endblock %}

{% block javascripts %}
        {{ parent() }}
        <script type="text/javascript">
                $(document).ready(function(){
                        $('#loadMore').click(function(){
                                event.preventDefault();
                                $.getJSON('{{ path('trick_loadMore', {category_slug: trick.category.slug, slug: trick.slug, id: trick.id}) }}',
                                        function(response){
                                                console.log(response);
                                                $.each(response, function (index, comment){
                                                        if (comment.end == 0) {
                                                                var $html = $('<li class="card mt-1">');
                                                                $html.append(   '<div class="card-body">' +
                                                                                        '<p class="card-text">' + comment.content + '</p>' +
                                                                                '</div>' +
                                                                                '<div class="card-footer text-muted">' +
                                                                                        '<div class="row">' +
                                                                                                '<div class="col">' +
                                                                                                        '<img class="rounded-circle profile" src="' + comment.photo + '" alt="photo"/>' +
                                                                                                '</div>' +
                                                                                                '<div class="col">' +
                                                                                                        '<div>Author : ' + comment.firstName + ' ' + comment.lastName + '</div>' +
                                                                                                        '<div>Created date :' + comment.createdDate + '</div>'+
                                                                                                '</div>' +
                                                                                        '</div>' +
                                                                                '</div>'
                                                                );
                                                                $('#myListMore').append($html);
                                                        } else {
                                                                $('#loadMore').hide();
                                                        }
                                                });
                                        },
                                );
                        });
                });
        </script>
{% endblock %}
